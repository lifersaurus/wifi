<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Comunicaciones Digitales</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --green:#28a745; --success:#198754; --danger:#dc3545; --bg:#f7f7f7; --text:#222; }
    *{box-sizing:border-box} html,body{margin:0;padding:0;height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
         display:flex;flex-direction:column;min-height:100vh;background:var(--bg)}
    header{background:var(--green);color:#fff;text-align:center;padding:1rem 0.75rem}
    header h1{margin:0;font-size:1.4rem;font-weight:700}
    main{flex:1;display:flex;align-items:center;justify-content:center;padding:1.25rem}
    .card{background:#fff;border:1px solid #e6e6e6;border-radius:14px;padding:1.25rem;max-width:520px;width:100%;
          box-shadow:0 2px 10px rgba(0,0,0,.06);text-align:center}
    .btn-row{display:flex;gap:.8rem;justify-content:center;flex-wrap:wrap;margin-bottom:1rem}
    button{appearance:none;border:0;border-radius:12px;padding:.9rem 1.4rem;font-size:1.1rem;font-weight:700;color:#fff;
           cursor:pointer;min-width:140px;transition:transform .05s ease}
    button:active{transform:scale(.98)}
    .ok{background:var(--success)} .cancel{background:var(--danger)}
    .status{margin:.9rem 0 1.2rem;font-size:1rem;color:#333}
    .pill{display:inline-block;padding:.35rem .7rem;border-radius:999px;font-weight:700;color:#fff;margin-left:.4rem}
    .pill.on{background:var(--success)} .pill.off{background:var(--danger)}
    footer{text-align:center;padding:.9rem;color:#666;font-size:.9rem}
  </style>
</head>
<body>
  <header><h1>Comunicaciones Digitales</h1></header>
  <main>
    <div class="card">
      <div class="status">LED:<span id="led-pill" class="pill off">OFF</span></div>
      <div class="btn-row">
        <button id="btn-on"  class="ok">LED ON</button>
        <button id="btn-off" class="cancel">LED OFF</button>
      </div>
      <hr>
      <div class="status">
        <strong>ADC0:</strong> <span id="adc-value">---</span><br>
        <strong>Voltaje:</strong> <span id="volt-value">---</span> V
      </div>
    </div>
  </main>
  <footer>&copy; Ingenier√≠a en Telecomunicaciones UMNG</footer>

  <script>
    const pill = document.getElementById('led-pill');
    const adcSpan = document.getElementById('adc-value');
    const voltSpan = document.getElementById('volt-value');

    const setUI = (on) => {
      pill.textContent = on ? 'ON' : 'OFF';
      pill.className = 'pill ' + (on ? 'on' : 'off');
    };

    async function post(url){
      try{ await fetch(url, {method:'POST', cache:'no-store'}); }catch(e){}
    }

    document.getElementById('btn-on').addEventListener('click', async ()=>{
      await post('/on'); setUI(true);
    });

    document.getElementById('btn-off').addEventListener('click', async ()=>{
      await post('/off'); setUI(false);
    });

    // === Lectura continua del ADC0 cada 1 segundo ===
    async function updateADC(){
      try{
        const res = await fetch('/adc', {cache:'no-store'});
        const data = await res.json();
        adcSpan.textContent = data.adc;
        voltSpan.textContent = data.voltaje.toFixed(3);
      }catch(e){
        adcSpan.textContent = 'Error';
        voltSpan.textContent = '---';
      }
    }
    setInterval(updateADC, 1000); // Actualiza cada segundo

    // Estado LED al iniciar
    fetch('/state', {cache:'no-store'})
      .then(r=>r.json()).then(d=>setUI(!!d.on)).catch(()=>{});
  </script>
</body>
</html>			